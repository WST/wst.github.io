<!doctype html><head><meta charset="utf-8"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=PT+Mono&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Bitter:wght@500;800&display=swap" rel="stylesheet"><link rel="stylesheet" href="/static/style.css?v=3"><script src="/static/instantclick.min.js?v=1" data-no-instant></script><link rel="stylesheet" href="/static/pygments.css"><title>Борьба с перегревом ноутбука — AverkovNET</title><link rel="shortcut icon" href="/static/icons/favicon.ico"></head><body><header><h1><a class="hover" href="/">AverkovNET</a></h1><nav><ul class="nav navbar-nav"><li><a href="/">Об авторе</a></li><li class="active"><a href="/articles/">Статьи</a></li><li><a href="/gallery/">Фотогалерея</a></li><li><a href="/social/">Контакты</a></li></ul></nav><div id="pony" style="float: right;position: relative; top: -180px; left: 0px; width: 164px; height: 200px; background-image: url('/static/images/really_cute_apple_bloom_by_kuren247-d6kdnrh.png');"></div></header><div class="page"><ul class="breadcrumb"><li><h2><a href="/">Приветствую!</a></h2></li><li><h2><a href="/articles/">Статьи</a></h2></li><li class="active"><h2>Борьба с перегревом ноутбука</h2></li></ul><p>Всегда не любил ноутбуки: экран маленький, клавиатура неудобная, да ещё и с фиксированным положением относительно экрана. Но есть у ноутбуков и несомненное преимущество&nbsp;— мобильность. Именно ноутбук приходит на помощь, когда имеется потребность в рабочем месте, которое всегда под рукой.</p><p>Есть одно свойство, присущее буквально каждому второму ноутбуку&nbsp;— перегрев. Среди ноутов, которыми мне доводилось владеть, эта проблема проявлялась на следующих моделях:</p><ul><li>MSI S430</li><li>Lenovo IdeaPad Z570</li><li>Infinix InBook X2</li></ul><p>Рассмотрю последние два случая, а именно — Lenono Z570 и Infinix X2. Lenono Z570 мне достался с рук и проблема перегрева в нём стояла очень остро: достаточно было запустить лишь один однопоточный процесс, использующий ядро на 100%, как температура всего кристалла доходила почти до 100°, если же использовать на всю катушку 2 и более ядер, температура достигала 100° и ноутбук прекращал работать (зависал). Поначалу я пытался это терпеть и как-то адаптировать свою работу, чтобы не нагружать процессор, но в какой-то момент моему терпению пришёл конец и я решил досконально изучить проблему.</p><p>Первым, что я обнаружил, оказалось то, что в моём экземпляре стоял «не родной» процессор Core i7-2670QM, что означало, что до меня этот ноутбук уже кто-то апгрейдил. Отмечу, что в таких старых ноутбуках замена процессора была тривиальной операцией, так как в то время процессоры в ноутбуках ставили в сокет, а не запаивали на плату (ball grid array). «Родными» же для данной модели, если верить Google, являлись процессоры Core&nbsp;i5-2450M и Core&nbsp;i3-2350M. Интересный момент заключается в том, что оба эти процессора имели TDP 35&nbsp;Вт, в то время как Core&nbsp;i7-2670QM&nbsp;— 45&nbsp;Вт. Таким образом, моим первым предположением было то, что система охлаждения банально не справляется с тепловыделением, на которое она не рассчитана. Однако, прежде, чем я успел купить менее горячий процессор, я решил просто из интереса разобрать ноут и снять систему охлаждения. К моему удивлению, я обнаружил, что слой термопасты между кристаллом и системой охлаждения был настолько толстый и сухой, что от него можно было буквально отламывать кусочки. Термопаста была оперативно заменена на новую, нанесённую тонким слоем, и проблема решилась — теперь я, наконец-то, смог загрузить все 4 ядра на 100% и температура доходила максимум до 80°. Много, но уже приемлемо.</p><p>Infinix X2, в отличие от Lenovo, достался мне новым, но уже «из коробки» легко перегревался, причём было заметно, что перегрев проявляется лишь в определённых задачах. К примеру, криптография в виде 8 параллельно запущенных экземпляров <span class="command">openssl speed</span> не приводила к такому перегреву, как запущенный в wine эмулятор <a href="https://tasvideos.org/EmulatorResources/Gens">gens-rerecording</a>, используемый для <a href="../tas/">TAS</a>, хотя эмулятор загружал лишь 1 ядро из 4, и то не на 100%. Также сильнейший перегрев вызывала компиляция C и C++ (к примеру сборка интерпретатора Python из исходного кода), а так как компиляция исходных кодов входила в мои должностные обязанности, я также не мог мириться с таким раскладом и начал разбираться.</p><p>Уже по привычке разобрал ноутбук, чтобы проверить состояние термопасты. Но в этот раз там всё оказалось замечательно. Термопасту я, конечно, заменил на свою, но, как нетрудно догадаться, это не дало нужного результата. Было похоже на то, что система охлаждения не справлялась с тепловыделением, но это было странно, особенно учитывая мизерный TDP процессора Core&nbsp;i7-1065G7 (15 Вт), а также вот эту картинку на сайте производителя:</p><p class="article-image article-image-bordered"><img src="/static/article-images/inbook-x2-cooling.png"></p><p>«Айс сторм», видишь ли! Не знаю, как вам, но мне сразу <a href="https://www.youtube.com/watch?v=PssXejaATDw">вспоминается</a> реплика «не, не айс!» из «отморозков в поисках ледяной свежести» :)</p><p>Шутки шутками, но делать что-то было нужно. И тут я вспомнил о модуле <s>ведра</s> ядра <span class="command">cpufreq</span>, выбирающем оптимальную тактовую частоту процессора, исходя из текущей загрузки системы. Этот модуль может работать с разными политиками, чаще всего это «performance» и «powersave». Причём практически все рабочие среды (KDE, Gnome, xfce, Mate, Budgie и прочие) имеют штатные средства для выбора активной политики. Тем не менее, это всё ещё немного не то, что нужно. Моя идея была в том, чтобы ограничить сверху выбор частоты и, к счастью, такая возможность в cpufreq есть.</p><p>Модуль cpufreq, как оказалось, позволяет пользователю задать нижний и верхний порог, в пределах которых будет выбираться частота, не меняя при этом политику. Самый простой способ сделать это — вручную записать требуемые значения в специальные псевдофайлы.</p><p>Сначала посмотрим текущую максимально допустимую частоту.</p><div class="hll"><pre><span></span>cat<span class="w"> </span>/sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
<span class="m">3900000</span>
</pre></div><p>Укажем максимально допустимую частоту, которую мы хотим использовать. Помним, что если процессор имеет несколько ядер, то и соответствующих псевдофайлов также будет несколько.</p><div class="hll"><pre><span></span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">0</span>..7<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="m">2400000</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/devices/system/cpu/cpu<span class="nv">$i</span>/cpufreq/scaling_max_freq<span class="p">;</span>
<span class="k">done</span>
</pre></div><p>Результат довольно ощутимый (было — стало).</p><p class="article-image article-image-bordered"><img src="/static/article-images/htop-temp.png"></p><p>Такой скрипт можно поставить на автозапуск при загрузке системы, но это, пожалуй, не очень удобно. Лучше сделать пару кнопок запуска на панели, которые будут задавать разные граничные частоты по клику. А можно пойти ещё дальше и установить себе приложение <a href="https://github.com/vagnum08/cpupower-gui">cpupower-gui</a>. В Ubuntu оно легко ставится через менеджер пакетов:</p><div class="hll"><pre><span></span>apt<span class="w"> </span>install<span class="w"> </span>cpupower-gui
</pre></div><p>Приложение имеет максимально интуитивно понятный интерфейс — главное не забывать, что при отжатой галочке «All CPUs» настройки будут применяться лишь к одному выбранному ядру.</p><p class="article-image"><img src="/static/article-images/cpupower-gui.png"></p><p>Интересно отметить тот факт, что перегреву могут быть подвержены (или не подвержены) как дешёвые, так и дорогие ноутбуки. Мне встречались ноуты и без проблемы перегрева, причём часть из них были довольно дорогими, другая же часть — максимально бюджетными. Таким образом, ориентироваться исключительно на цену я бы не рекомендовал, перед покупкой ноутбука обязательно изучайте отзывы.</p></div><footer> ©&nbsp;Илья&nbsp;Аверков (WST) </footer><script data-no-instant>InstantClick.init('mousedown');</script></body>